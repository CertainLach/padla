dist: bionic
language: java

before_install: wget https://raw.githubusercontent.com/sormuras/bach/master/install-jdk.sh

script: mvn verify -DskipTests=true -Dmaven.javadoc.skip=true -B -V

### Maven basic build ###
jobs:
  include:
    - name: Default JDK
      install: source ./install-jdk.sh --verbose
    - name: JDK 8 # LTS
      install: source ./install-jdk.sh --verbose --feature 11
    - name: JDK 11 # LTS
      install: source ./install-jdk.sh --verbose --feature 11
    - name: JDK 14 # Latest GA experimental
      install: source ./install-jdk.sh --verbose --feature 14
    - name: JDK 15 # Latest non-GA experimental
      install: source ./install-jdk.sh --verbose --feature 15

before_deploy: ./.travis/scripts/import_code_signing_keys.sh

deploy:
  # Deploy snapshot to Sonatype OSSRH
  - provider: script
    edge: true
    script: ./.travis/scripts/maven_deploy.sh
    on:
      branch: development
      condition: "\"$(./.travis/scripts/get_version.sh)\" == *-SNAPSHOT"

  # Deploy release to Maven Central
  - provider: script
    edge: true
    script: ./.travis/scripts/maven_deploy.sh release
    on:
      branch: master
      tags: true
      condition: "\"$(./.travis/scripts/get_version.sh)\" != *-SNAPSHOT"

cache:
  directories:
    - ~/.m2/repository
